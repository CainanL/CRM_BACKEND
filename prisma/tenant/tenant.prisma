generator tenantClient {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/tenant-client"
}

datasource tenantDb {
  provider = "postgresql"
  url      = env("TENANT_DATABASE_URL")
}

// Solução, nome da atividade. Ex: Projeto Elétrico, energia solar, desenvolvimento de software.
model Solution {
  id          String                     @id @default(uuid())
  name        String                     @unique
  description String?
  priceRanger SolutionPriceRanger[]
  documents   SolutionCapturedLead[]

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  fieldSettings SolutionFieldSettings[]

  @@map("solutions")
}

// valor cobrado por determinado ranger. Ex: R$ 600 por KWp, R$ 120 por hora.
model SolutionPriceRanger {
  id                String   @id @default(uuid())
  title             String   
  description       String?
  price             Decimal? @tenantDb.Decimal(10, 2)
  ranger            Decimal?  @tenantDb.Decimal(10, 2)
  unitOfMeasurement String?

  solutionId String
  solution   Solution @relation(fields: [solutionId], references: [id])

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("solution_price_rangers")
}

// Parâmetros para criação do input. Ex: dataType: CPF, formatType: string, mask: 999.999.999-99, title: CPF, placeholder: CPF
model SolutionFieldSettings {
  id          String  @id @default(uuid())
  dataType    String                    // Tipo de dado (text, email, phone, number, date, etc.)
  formatType  String                    // Formato específico (cpf, cnpj, phone, etc.)
  mask        String?                   // Máscara para formatação
  title       String                    // Título do campo
  placeholder String                    // Placeholder do input
  isRequired  Boolean                   @default(false)  // Campo obrigatório
  order       Int                       @default(0)      // Ordem de exibição

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  solutionId String
  solution   Solution @relation(fields: [solutionId], references: [id])

  SolutionFieldValue SolutionFieldValue[]

  @@map("solution_field_settings")
}

// Valor do input. Ex: CPF, valor = 000.000.000-00
model SolutionFieldValue {
  id    String  @id @default(uuid())
  title String
  value String?

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  documentId String
  document   SolutionCapturedLead @relation(fields: [documentId], references: [id])

  settingsId String
  settings SolutionFieldSettings @relation(fields: [settingsId], references: [id])

  @@map("solution_field_values")
}

// Contem o agrupamento de inputs de cada solution juntando os dados de input e vinculando a informação ao lead que está sendo criado aqui.
// Cada SolutionCapturedDocument representa um lead completo
model SolutionCapturedLead {
  id String @id @default(uuid())

  // Status do lead (opcional, pode ser configurado pelo usuário)
  status      String?                   @default("NEW")
  
  // Campos padrão do sistema
  isActive    Boolean                   @default(true)
  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @updatedAt

  // Relacionamentos
  fielValues  SolutionFieldValue[]
  solutionId  String
  solution    Solution @relation(fields: [solutionId], references: [id])

  @@map("solution_captured_leads")
}

// Endereço do funcionário
model EmployeeAddress {
  id          String   @id @default(uuid())
  street      String   // Nome da rua
  number      String   // Número da residência
  complement String?   // Complemento (opcional)
  district   String   // Bairro
  city       String   // Cidade
  state      String   // Estado
  cep        String   // CEP
  
  // Relacionamento com Employee (1:1)
  employeeId String   @unique
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  // Campos padrão do sistema
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("employee_addresses")
}

// Funcionário da empresa
model Employee {
  id                  String         @id @default(uuid())
  fullName            String         // Nome completo do funcionário
  photo               String?        // URL da foto (opcional)
  cpf                 String         @unique // CPF único
  birthDate           DateTime       // Data de nascimento
  sex                 String         // Sexo (MALE, FEMALE, OTHER)
  email               String         @unique // Email único
  phone               String?        // Telefone (opcional)
  
  // Relacionamento com endereço (1:1)
  address             EmployeeAddress?
  
  function            String         // Cargo/função
  department          String         // Departamento
  internalRegistration String        @unique // Registro interno único
  admissionDate       DateTime       // Data de admissão
  typeOfContract      String         // Tipo de contrato (CLT, PJ, TEMPORARY, INTERNSHIP, TRAINEE)
  salary              Decimal        @tenantDb.Decimal(10, 2) // Salário base
  comission           Decimal?       @tenantDb.Decimal(10, 2) // Comissão (opcional)
  status              String         // Status (ACTIVE, INACTIVE, VACATION, ON_LEAVE, TERMINATED)
  userId              String?        // Referência ao usuário para autenticação (opcional)
  
  // Campos padrão do sistema
  isActive            Boolean        @default(true)
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt

  @@map("employees")
}
